"use strict";ApplicationConfiguration.registerModule("auth"),ApplicationConfiguration.registerModule("campaign"),ApplicationConfiguration.registerModule("campaigns"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("download"),ApplicationConfiguration.registerModule("export"),ApplicationConfiguration.registerModule("files"),ApplicationConfiguration.registerModule("header"),ApplicationConfiguration.registerModule("list"),ApplicationConfiguration.registerModule("search"),ApplicationConfiguration.registerModule("searchRecords"),ApplicationConfiguration.registerModule("sourcemaps"),ApplicationConfiguration.registerModule("sources"),ApplicationConfiguration.registerModule("upload"),function(){function e(e){e.when("/login",{templateUrl:"/authentication/client/views/login.client.view.html",controllerAs:"vm"})}angular.module("auth").config(e),e.$inject=["$routeProvider"]}(),function(){function e(e){e.when("/register",{templateUrl:"/authentication/client/views/register.client.view.html",controllerAs:"vm"})}angular.module("auth").config(e),e.$inject=["$routeProvider"]}(),function(){function e(e,n,t){function o(){t.login(r.user).then(function(){n.open("/","_self")})}var r=this;r.user={email:"",password:""},r.login=o,function(){t.isLoggedIn()&&e.path("/")}()}angular.module("auth").controller("LoginController",e),e.$inject=["$location","$window","authentication"]}(),function(){function e(e,n){function t(){n.register(o.user)}var o=this;o.user={FirstName:"",LastName:"",Email:"",Password:"",Department:""},o.departments=["Operations","Data","Client Services"],o.register=t}angular.module("auth").controller("RegisterController",e),e.$inject=["$location","authentication"]}(),function(){function e(e,n,t,o,r){function a(e){r.localStorage["db-token"]=e}function c(){return r.localStorage["db-token"]}function i(){delete r.localStorage["db-token"],r.location.href="/#!/login",r.location.reload()}function s(){var e,n=c();return!!n&&(e=n.split(".")[1],e=r.atob(e),(e=JSON.parse(e)).exp>Date.now()/1e3)}function u(){if(s()){var e=c().split(".")[1];return e=r.atob(e),e=JSON.parse(e),{_id:e._id,name:e.name}}}function l(e){var n=t.defer();return new(o("/api/register"))(e).$save(function(e){e.error?n.reject(e.error):(a(e.data),n.resolve())}),n.promise}function d(e){var n=t.defer();return new(o("/api/login"))(e).$save(function(e){e.error?n.reject(e.error):(a(e.data),n.resolve())}),n.promise}function f(){return s()||n.path("/login"),!0}function p(){var e=c();return e?"Bearer "+e:""}return function(){e.defaults.headers.common.Authorization=p()}(),{saveToken:a,getToken:c,logout:i,isLoggedIn:s,register:l,login:d,authenticate:f,currentUser:u,setAuth:p}}angular.module("auth").service("authentication",e),e.$inject=["$http","$location","$q","$resource","$window"]}(),function(){function e(e){e.when("/:acronym/:path",{templateUrl:"/campaign/client/views/campaign.client.view.html",controllerAs:"vm",acronym:"@Acronym",name:"@Name"})}angular.module("campaign").config(e),e.$inject=["$routeProvider"]}(),function(){function e(e,n,t,o,r,a,c,i,s){function u(){return l().then(d)}function l(){return n.getCampaign().then(f).catch(M)}function d(){return n.getRecordCount().then(p).catch(p)}function f(e){b.campaign=e.campaign,b.client=e.client}function p(e){b.count=m(e),b.isLoading=!1}function m(e){if(e.Total>0){e.Total+=e.Dupes+e.DupesWithinFile;var n=e.Total-(e.Dupes+e.DupesWithinFile);e.callable=Math.round(n/e.Total*1e3/10),e.regs=Math.round(n*(b.campaign.Conversion/100)),e.toContact=Math.round(n*(b.campaign.ContactRate/100))}else e.Total=0,e.Invalids=0,e.Dupes=0,e.DupesWithinFile=0,e.callable=0,e.regs=0,e.toContact=0;return e}function h(){var e=c.defer();return e.resolve(a.$broadcast("closeModal")),e.promise}function g(){e.path("/"+b.client.Acronym+"/"+b.campaign.Path+"/upload")}function v(){function e(){var e=t.createModal({modalState:b.modalStates,name:"Download",size:"lg-mid",resolve:{Campaign:b.campaign,Client:b.client}});e.result.then(u),t.markModalClosed(b.modalStates,e.result,"Download")}h().then(e)}function S(){function e(){var e=t.createModal({modalState:b.modalStates,name:"Lists",resolve:{Campaign:b.campaign,Client:b.client}});e.result.then(function(e){b.campaign=e}),t.markModalClosed(b.modalStates,e.result,"Lists")}h().then(e)}function y(){function e(){var e=t.createModal({modalState:b.modalStates,name:"Sources",resolve:{Campaign:b.campaign,Client:b.client}});e.result.then(d),t.markModalClosed(b.modalStates,e.result,"Sources")}h().then(e)}function C(){function e(){var e=t.createModal({modalState:b.modalStates,name:"Header",resolve:{Campaign:b.campaign,Client:b.client}});t.markModalClosed(b.modalStates,e.result,"Header")}h().then(e)}function w(){function e(){var e=t.createModal({modalState:b.modalStates,size:"lg-mid",name:"Export",resolve:{Campaign:b.campaign}});t.markModalClosed(b.modalStates,e.result,"Export")}h().then(e)}function $(){function e(){var e=t.createModal({modalState:b.modalStates,name:"Files",resolve:{Campaign:b.campaign}});e.result.then(u),t.markModalClosed(b.modalStates,e.result,"Files")}h().then(e)}function M(e){console.log(e),b.isLoading=!1}var b=this;b.campaign={},b.client={},b.nav=s,b.uploadModal=g,b.sourceModal=y,b.downloadModal=v,b.headerModal=C,b.listModal=S,b.exportModal=w,b.fileModal=$,b.modalStates={},function(){i.authenticate(),b.isLoading=!0,u()}()}angular.module("campaign").controller("CampaignController",e),e.$inject=["$location","SingleCampaignService","ModalService","$uibModalStack","$scope","$rootScope","$q","authentication","Navigation"]}(),function(){function e(e,n,t){function o(n){var o=t.defer();return n&&(e=n),a.get(e,function(e){return e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function r(){var n=t.defer();return c.get(e,function(e){return e.error?n.reject(e.error):n.resolve(e.data)}),n.promise}var a=n("api/:acronym/:path",{acronym:"@Acronym",path:"@Path"}),c=n("api/:acronym/:path/count",{acronym:"@Acronym",path:"@Path"});return{getCampaign:o,getRecordCount:r}}angular.module("campaign").factory("SingleCampaignService",e),e.$inject=["$routeParams","$resource","$q"]}(),function(){function e(e,n){function t(t){var o="/"+t.client.Acronym+"/"+t.campaign.Path+"/upload";e.path()===o&&n.reload(),e.path(o)}function o(n){e.path("/"+n.client.Acronym+"/"+n.campaign.Path+"/download")}function r(n){e.path("/"+n.client.Acronym+"/"+n.campaign.Path+"/lists")}function a(n){e.path("/"+n.client.Acronym+"/"+n.campaign.Path+"/sources")}function c(n){e.path("/"+n.client.Acronym+"/"+n.campaign.Path+"/headers")}function i(n){e.path("/"+n.client.Acronym+"/"+n.campaign.Path+"/files")}function s(n){e.path("/"+n.client.Acronym+"/"+n.campaign.Path)}function u(n){e.path("/"+n.client.Acronym+"/"+n.campaign.Path+"/export")}return{upload:t,download:o,lists:r,sources:a,headers:c,files:i,stats:s,exports:u}}angular.module("campaign").factory("Navigation",e),e.$inject=["$location","$route"]}(),function(){function e(e){e.when("/client/:acronym",{templateUrl:"/campaigns/client/views/campaigns.client.view.html",controllerAs:"vm",acronym:"@Acronym"})}angular.module("campaigns").config(e),e.$inject=["$routeProvider"]}(),function(){function e(e,n,t,o,r){function a(e){u.form=e,t.addCampaign(u.campaign).then(i).catch(s)}function c(){u.error=""}function i(e){e?n.close(e):n.dismiss("cancel")}function s(e){u.error=o.handleError(e,u.Name),u.campaign={},u.form.$setPristine()}var u=this;u.Name="Campaign",u.campaign={},u.addCampaign=a,u.closeModal=i,u.closeAlert=c,function(){r.isLoggedIn()?u.campaign.Creator=r.currentUser()._id:e.path("/login")}()}angular.module("campaigns").controller("AddCampaignController",e),e.$inject=["$location","$uibModalInstance","CampaignService","ErrorHandler","authentication"]}(),function(){function e(e,n,t,o,r){function a(){function e(e){d.client=e}o.createModal({location:"campaigns",name:"Add-Campaign",size:"md"}).result.then(e).catch(u)}function c(e){function n(e){console.log("updated client: ",e),d.client=e}o.createModal({location:"campaigns",name:"Edit-Campaign",size:"md",resolve:{Campaign:d.client.Campaigns[e]}}).result.then(n).catch(u)}function i(){}function s(n){var t=d.client.Campaigns.filter(function(e){return e._id===n})[0];e.path("/"+d.client.Acronym+"/"+t.Path)}function u(e){console.log(e)}function l(e){d.sortKey=e,console.log(e),d.sortKey===e&&(d.reverse=!d.reverse)}var d=this;d.client={},d.addCampaignModal=a,d.editCampaignModal=c,d.deleteCampaignModal=i,d.openCampaignPage=s,d.sort=l,function(){function e(e){d.client=e.client,d.count=e.count}r.authenticate(),t.getClient().then(e).catch(u)}()}angular.module("campaigns").controller("ClientCtrl",e),e.$inject=["$location","$uibModal","EditClient","ModalService","authentication"]}(),function(){function e(e,n,t,o,r){function a(e,n){for(var t in n){var o=e[t],r=n[t];if(!(r===o||c(r)&&c(o)))return!0}return!1}function c(e){return Array.isArray(e)&&0===e.length}function i(){a(t.Campaign,d.campaign)?o.updateCampaign(d.campaign).then(s).catch(u):s()}function s(e){e?n.close(e):n.dismiss("cancel")}function u(e){d.error=r.handleError(e,d.Name),d.campaign=t.Campaign}function l(){d.error=""}var d=this;d.Name="Campaign",d.campaign=angular.copy(t.Campaign),d.updateCampaign=i,d.closeModal=s,d.closeAlert=l}angular.module("campaigns").controller("EditCampaignController",e),e.$inject=["$location","$uibModalInstance","data","CampaignService","ErrorHandler"]}(),function(){function e(e,n,t,o){function r(){return u=n.defer(),l.get(t,s),u.promise}function a(){var t=e("/api/all-campaigns");return u=n.defer(),t.get(s),u.promise}function c(e){u=n.defer();var o=new l({Campaign:e});return l.update(t,o,s),u.promise}function i(e){u=n.defer();var o=new l({Campaign:e});return console.log(t),o.$save(t,s),u.promise}function s(e){e.error?u.reject(e.error):u.resolve(e.data)}var u,l=e("/api/client/:acronym/campaigns",{acronym:"@Acronym"},{update:{method:"PUT"}});return{getClient:r,addCampaign:i,updateCampaign:c,getAllCampaigns:a}}angular.module("campaigns").factory("CampaignService",e),e.$inject=["$resource","$q","$routeParams","GeneralFuncService"]}(),function(){function e(e,n,t){function o(){var e=n.defer();return r.get(t,function(n){n.error?e.reject(n.error):e.resolve(n.data)}),e.promise}var r=e("api/client/:acronym",{acronym:"@Acronym"});return{getClient:o}}angular.module("campaigns").factory("EditClient",e),e.$inject=["$resource","$q","$routeParams"]}();var ApplicationConfiguration=function(){return{applicationModuleName:"data-uploader",applicationModuleVendorDependencies:["ngResource","ngRoute","ui.bootstrap","ngFileUpload","ngPapaParse","isteven-multi-select","ngAnimate","ngCsv","infinite-scroll","angularUtils.directives.dirPagination"],registerModule:function(e,n){angular.module(e,n||[]),angular.module("data-uploader").requires.push(e)}}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(e){e.hashPrefix("!")}]),"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.element(document).ready(function(){angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),function(){function e(e){e.when("/",{templateUrl:"/core/client/views/core.client.view.html",controllerAs:"vm"})}angular.module("core").config(e),e.$inject=["$routeProvider"]}(),function(){function e(e,n,t,o){function r(e){n.addClient(u.client).then(a).catch(function(n){u.error=t.handleError(n,u.Name),c(e)})}function a(n){e.close(n)}function c(e){u.client={},e.$setPristine()}function i(){u.error=""}function s(){e.dismiss("cancel")}var u=this;u.Name="Client",u.error="",u.client={},u.addClient=r,u.closeAlert=i,u.closeModal=s,function(){var e=o.currentUser();console.log("user: ",e),null!==e&&(u.client.Creator=e._id)}()}angular.module("core").controller("AddClientController",e),e.$inject=["$uibModalInstance","ClientService","ErrorHandler","authentication"]}(),function(){function e(e,n,t,o,r){function a(){t.receiveClients().then(c).catch(h)}function c(e){v.clients=e}function i(){o.createModal({location:"core",name:"Add-Client",size:"md"}).result.then(s).catch(h)}function s(e){v.clients.push(e)}function u(e){o.createModal({location:"core",name:"Edit-Client",resolve:{Client:v.clients[e]},size:"md"}).result.then(l)}function l(e){v.clients=v.clients.map(function(n){return n._id===e._id&&(n=e),n})}function d(e){o.createModal({location:"core",name:"Delete-Client",resolve:{Client:v.clients[e]},size:"md"}).result.then(f).catch(h)}function f(e){t.removeClient(e._id).then(p).catch(h)}function p(e){v.clients=v.clients.filter(function(n){return n.Name!==e.Name})}function m(n){console.log("index: ",n);var t=v.clients.filter(function(e){return e._id===n})[0];console.log(t),e.path("/client/"+t.Acronym)}function h(e){console.log(e)}function g(e){v.sortKey=e,console.log(e),v.sortKey===e&&(v.reverse=!v.reverse)}var v=this;v.Name="Client",v.clients=[],v.openClientPage=m,v.addClientModal=i,v.editClientModal=u,v.deleteClientModal=d,v.sort=g,function(){r.authenticate(),a()}()}angular.module("core").controller("CoreCtrl",e),e.$inject=["$location","$uibModal","ClientService","ModalService","authentication"]}(),function(){function e(e,n){function t(){n.dismiss("cancel")}function o(){n.close(r.client)}var r=this;r.client=angular.copy(e.Client),r.closeModal=t,r.deleteClient=o}angular.module("core").controller("DeleteClientController",e),e.$inject=["data","$uibModalInstance"]}(),function(){function e(e,n,t,o){function r(){a(t.Client,l.client)?n.updateClient(l.client).then(i).catch(s):i()}function a(e,n){for(var t in n){var o=e[t],r=n[t];if(!(r===o||c(r)&&c(o)))return!0}return!1}function c(e){return Array.isArray(e)&&0===e.length}function i(n){n?e.close(n):e.dismiss("cancel")}function s(e){l.error=o.handleError(e,l.Name),l.client=t.Client}function u(){l.error=""}var l=this;l.Name="Client",l.client=angular.copy(t.Client),l.closeModal=i,l.closeAlert=u,l.updateClient=r}angular.module("core").controller("EditClientController",e),e.$inject=["$uibModalInstance","ClientService","data","ErrorHandler"]}(),function(){function e(){function e(e,n,t){console.log("scope: ",e)}return{bindToController:!0,controller:n,controllerAs:"vm",link:e,restrict:"EA",templateUrl:"/core/client/directives/new-table.client.view.html",scope:{data:"=data",exclude:"=exclude",unpack:"=unpack",actions:"=actions",funcs:"&funcs"}}}function n(e){function n(e){r.sortKey=e,r.sortKey===e&&(r.reverse=!r.reverse)}function t(e){o(e[0])}function o(e){r.keys=[];for(var n in e)if(-1===r.excludeKeys.indexOf(n))if(-1!==r.unpack.indexOf(n))for(var t in e[n])r.keys.push(t);else r.keys.push(n);r.keys.push("Actions")}var r=this;r.sort=n,e.$watch("vm.data",function(){e.$watch("vm.exclude",function(){e.$watch("vm.unpack",function(){e.$watch("vm.actions",function(){e.$watch("vm.funcs",function(){r.functions=r.funcs,console.log("table functions: ",r.funcs),r.excludeKeys=r.exclude,r.buttons=r.actions,r.data&&0!==r.data.length&&t(r.data)})})})})})}angular.module("core").directive("editableTable",e),e.inject=[""]}(),function(){function e(){function e(e,n,t){console.log("scope: ",e),e.vm.testfunc=e.vm.functions(0)}return{bindToController:!0,controller:n,controllerAs:"vm",link:e,restrict:"EA",templateUrl:"/core/client/directives/row.client.view.html",scope:{data:"=data",exclusion:"=exclusion",unpacked:"=unpacked",tablekeys:"=tablekeys",buttons:"=buttons",functions:"&functions"}}}function n(e,n,t){function o(e){console.log(e)}function r(e){a(e),l.tablekeys.forEach(function(n){if("Actions"!==n){var t=e[n];s(t)?c(n,t):u(t)?i(n,t):l.rowData[n]=t}})}function a(e){l.unpacked.forEach(function(n){var t=e[n];for(var o in t)e[o]=t[o]})}function c(e,n){l.rowData[e]=n.length}function i(e,n){if(-1!==l.unpacked.indexOf(e))for(var t in n)l.rowData[t]=n[t];else l.rowData[e]=e}function s(e){return"[object Array]"===Object.prototype.toString.call(e)}function u(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}var l=this;l.exclude=[],l.rowData={};l.test=n.trustAsHtml('<Button class="btn btn-circle btn-lg">test</Button><Button class="btn btn-circle btn-lg">test</Button>'),l.testfunc=o,e.$watch("vm.data",function(){e.$watch("vm.exclusion",function(){e.$watch("vm.unpacked",function(){e.$watch("vm.tablekeys",function(){l.excludeKeys=l.exclusion,l.data&&0!==l.data.length&&r(l.data)})})})})}angular.module("core").directive("editableRow",e),e.inject=["ModalService"]}(),function(){function e(){function e(e,n,t){e.$watch("vm.data",function(e){console.log(e)})}return{bindToController:!0,controller:n,controllerAs:"vm",link:e,restrict:"EA",templateUrl:"/core/client/directives/table-dir.client.view.html",scope:{data:"=data",exclude:"=exclude",disable:"=disable"}}}function n(e){function n(n){p.row=p.data[n],e.$watch("vm.disable",function(){createEdit(p.row,p.editData)})}function t(e){for(var n in e)return n}function o(e){for(var n in e)return e[n]}function r(e,n,t){d(e)?c(e,t||n):f(e)&&(i(e,n),a(e,t))}function a(e,n){for(var t in e)r(e[t],n,t)}function c(e,n){e.forEach(function(e,t){r(e,n,n)})}function i(e,n){var t={};for(var o in e)if(f(e[o])||d(e[o]))r(e[o],n+"."+o);else{var a={};a[o]=e[o],t[n]?t[o]=a:t[o]={}}p.keys[n]?p.keys[n].push(e):p.keys[n]=[e]}function s(e){e&&(f(e)?p.tData=u(e):d(e)&&(console.log("table: ",e),p.tData=e.map(u)),p.headers=p.tData.slice(0,1),console.log("headers: ",p.headers),console.log(p.tData))}function u(e){var n=[];if(f(e)){for(var t in e)n.push(l({key:t,value:e[t]}));return console.log("Objects: ",n),n}return[{key:"",value:e}]}function l(e){return array(e.value)?(e.array=e.value,e.value=e.value.length,e.isArray=!0):f(e.value)&&(e.isLink=!0),e}function d(e){return"[object Array]"===Object.prototype.toString.call(e)}function f(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}var p=this;p.keys={},p.table={},p.values=[],p.vals=[],p.editData=[],p.tableData=[],p.selectRow=n,p.createTableData=s,e.$watch("vm.data",function(){console.log("Original Data: ",p.data),r(o(p.data),t(p.data)),console.log("keys: ",p.table),console.log("table: ,",p.keys)})}angular.module("core").directive("editableTable",e),e.inject=[""]}(),function(){function e(e,n,t,o,r,a,c){function i(e){var n=o.defer(),t=new d(e),r=c(n);return t.$save(r),n.promise}function s(){var e=o.defer(),n=c(e);return d.get(n),e.promise}function u(e){var n=o.defer(),t=c(n);return d.delete({_id:e},t),n.promise}function l(e){var n=o.defer(),t=c(n);new d(e);return d.update(e,t),n.promise}var d=t("/api/clients",{},{update:{method:"PUT"}});return{addClient:i,receiveClients:s,removeClient:u,updateClient:l}}angular.module("core").factory("ClientService",e),e.$inject=["$window","$http","$resource","$q","GeneralFuncService","authentication","ResponseHandler"]}(),function(){function e(){function e(e){return e.timestamp={created:o(e.Created),updated:o(e.Updated)},e}function n(e){var n=r(e);return a(n)+c(n)+i(n,2)}function t(e){var n=r(e);return a(n)+"/"+c(n)+"/"+i(n,4)}function o(e){var n=r(e);return a(n)+"/"+c(n)+"/"+i(n,4)+" "+s(n)+":"+u(n)}function r(e){try{return new Date(e)}catch(e){return new Error("not a date")}}function a(e){return l(e.getDate())}function c(e){return l(e.getMonth()+1)}function i(e,n){return e.getFullYear().toString().slice(-n)}function s(e){return l(e.getHours())}function u(e){return l(e.getMinutes())}function l(e){return("0"+e).slice(-2)}return{createTimestamp:o,setTimestamp:e,formatDate:t,fileDate:n}}angular.module("core").factory("DateFormat",e)}(),function(){function e(e){function n(){return{start:new Date,end:new Date}}function t(e){return null}function o(e){e.opened=!0}function r(e,n,t,o){new Date(e,n,t)}return{today:n,clear:t,open:o,setStart:r}}angular.module("core").factory("DatePicker",e),e.$inject=["$http"]}(),function(){function e(){function e(e,t){switch(e.code){case 11e3:return n(e,t);case"DupeName":return{message:e.errmsg}}}function n(e,n){return{message:n+" with those details already exists"}}return{handleError:e}}angular.module("core").factory("ErrorHandler",e),e.$inject=[]}(),function(){function e(e){function n(e){return-1!==e.indexOf(" ")?e.split(" ").map(t).join(" "):t(e)}function t(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function o(e){return-1===e.ascending.indexOf(e.field)?(e.ascending.push(e.field),r(e)):(e.ascending.splice(e.ascending.indexOf(e.field),1),r(e),e.records.reverse()),e}function r(e){function n(e,n){return e[r].localeCompare(n[r])}function t(e,n){return e[o.first][o.second].localeCompare(n[o.first][o.second])}var o,r=e.field,c=e.records;-1!==r.indexOf(".")?(o=a(r),c.sort(t)):c.sort(n)}function a(e){return{first:e.split(".")[0],second:e.split(".")[1]}}function c(e){e.records.slice(e.tableRecords.length,e.tableRecords.length+1).forEach(function(n){e.tableRecords.push(n)})}return{capitalize:n,sort:o,infiniteScroll:c}}angular.module("core").factory("GeneralFuncService",e),e.$inject=["$http"]}(),function(){function e(e,n){function t(e){return o(c(e))}function o(t){var o=angular.element(e[0].querySelector(".base")),r={animationsEnable:!0,ariaLabelledBy:"panel-heading",ariaDescribedBy:"panel-body",templateUrl:t.templateUrl,controller:t.ctrlName,controllerAs:"vm",size:t.size,backdrop:t.backdrop||"static",appendTo:o};return t.resolve&&(r.resolve=t.resolve),n.open(r)}function r(e,n,t){n.finally(function(){e[t]=!1})}function a(e){return{data:e}}function c(e){e.modalState&&(e.modalState[e.name]=!0);var n=e.name.toLowerCase(),t=e.location||n;return{ctrlName:(e.name.replace("-","")+"Controller").toString(),templateUrl:"/"+t+"/client/views/"+n+".client.view.html",size:e.size||"xl",resolve:a(e.resolve),backdrop:e.backdrop||"static"}}return{createModal:t,markModalClosed:r}}angular.module("core").factory("ModalService",e),e.$inject=["$document","$uibModal"]}(),function(){function e(){return function(e){return function(n){n.error?e.reject(n.error):e.resolve(n.data)}}}angular.module("core").factory("ResponseHandler",e),e.$inject=[]}(),function(){function e(e,n,t,o,r,a,c){function i(e){d.isLoading=!0,d.query=e;var n=a.prepareFileForDownload(d);d.filename=n.filename,d.headers=n.headers;var t=function(e){function n(e){return d.isLoading=!1,e}function t(e){d.isLoading=!1,console.log(e)}return o.retrieveRecords(e).then(n).catch(t)}(d.query);if(t)return t}function s(e){function n(e){e||(t=!1)}var t=!0;return e.forEach(n),t}function u(e){function n(n){d.downloadType[n]=n===e}Object.keys(d.downloadType).forEach(n)}function l(){e.close()}var d=this;d.campaign=n.Campaign,d.client=n.Client,d.headers=[],d.recordStates={isDuplicate:!1,isDuplicateWithinFile:!1,isInvalid:!1,isClean:!0},d.downloadType={byCampaign:!1,byFile:!1,byList:!1,bySource:!1},d.datepicker={today:t.today,popup1:{},popup2:{},date:{},open:t.open},d.download=i,d.downloadValid=s,d.showDownloadOptions=u,d.closeModal=l,c.$on("closeModal",function(e){l()})}angular.module("download").controller("DownloadController",e),e.$inject=["$uibModalInstance","data","DatePicker","DownloadService","DateFormat","DownloadFileService","$rootScope"]}(),function(){function e(e,n,t,o,r,a,c){function i(){function e(e){f.downloadType[e]=e===n}var n="by"+f.selectedType;Object.keys(f.downloadType).forEach(e),console.log(f.downloadType)}function s(e){var n={},t={campaign:f.campaign,client:f.client,start:f.start,end:f.end};f.downloadType.byFile&&(n=function(e){return t.file=e,{File:e._id}}(e)),f.downloadType.bySource&&(n=function(e){return t.source=e,{Source:e._id,Created:{$gte:f.start,$lt:f.end}}}(e)),f.downloadType.byList&&(n=function(e){return t.list=e,{List:e._id}}(e)),f.downloadType.byCampaign&&(n=function(){return{Campaign:f.campaign._id,Created:{$gte:f.start,$lt:f.end}}}()),t.downloadType=f.downloadType,function(){"Clean"!==f.selectedRecordState&&(n.$or={isDuplicate:!0,isDuplicateWithinFile:!0})}(),"Clean"!==f.selectedRecordState&&(t.recordStates={isDuplicate:!0,isDuplicateWithinFile:!0,isInvalid:!0});var o=a.prepareFileForDownload(t);return f.headers=o.headers,f.filename=o.filename,console.log(n),u(n)}function u(e){function n(e){return f.isLoading=!1,e}function t(e){f.isLoading=!1,console.log(e)}return c.retrieveRecords(e).then(n).catch(t)}function l(e){f.sortKey=e,f.sortKey===e&&(f.reverse=!f.reverse)}function d(e){console.log(e)}var f=this;f.client={},f.campaign={},f.nav=n,f.start=new Date,f.end=new Date,f.downloadType={byCampaign:!1,byFile:!1,byList:!1,bySource:!1},f.datepicker={today:r.today,popup1:{},popup2:{},date:{},open:r.open},f.downloadTypes=["File","List","Source","Campaign"],f.selectedType={},f.recordStates=["Clean","All"],f.selectedRecordState="Clean",f.showDownloadOptions=i,f.download=s,f.sort=l,function(){function n(){f.campaign.Files.forEach(function(e){e.Created=o.createTimestamp(e.Created),e.Updated=o.createTimestamp(e.Updated)})}t.authenticate(),f.isLoading=!0,function(){function n(e){f.campaign=e.campaign,f.client=e.client}return e.getCampaign().then(n).catch(d)}().then(function(){f.isLoading=!1,n()})}()}angular.module("download").controller("DownloadCtrl",e),e.$inject=["SingleCampaignService","Navigation","authentication","DateFormat","DatePicker","DownloadFileService","DownloadService"]}(),function(){function e(e,n,t){function o(t){var o=e.defer();return new r(n).$get(t,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}var r=t("/api/:acronym/:path/download",{path:"@path",acronym:"@acronym"});return{retrieveRecords:o}}angular.module("download").factory("DownloadService",e),e.$inject=["$q","$routeParams","$resource"]}(),function(){function e(e){function n(n){var o=function(e){return o=["CustKey","Phone1","Phone2","DOB","Gender","Title","FirstName","LastName","Address1","Address2","Suburb","State","Postcode","Email","MobilePhone","HomePhone","SiteLabel","Source","Client","Campaign","File","List"],function(){function n(n){e[n]&&("isClean"!==n&&o.push(n),a=!0)}function r(e){o.push(e)}var a=!1;e&&(Object.keys(e).forEach(n),a||t.forEach(r))}(),o}(n.recordStates),r=function(){var t;return function(){n.start&&n.end&&(n.start.setHours(0,0,0,0),n.end.setHours(23,59,59,59))}(),function(){function o(e){return e.replace(".csv","").replace(".xlsx","").replace(".xls","").replace(".xlsm","")}function r(){function e(e){n.recordStates[e]&&t.push(e)}var t=[];return n.recordStates?Object.keys(n.recordStates).forEach(e):t=["Clean"],function(){return t.length>0?"("+t.join("_")+")":"(All)"}()}console.log(n.downloadType),n.downloadType.byFile?function(){t=o(n.file.Name)+" "+r()+".csv"}():n.downloadType.byCampaign?function(){t=n.client.Acronym+" "+n.campaign.Name+" "+e.fileDate(n.start)+"-"+e.fileDate(n.end)+" "+r()+".csv"}():n.downloadType.byList?function(){t=n.list.Name+" "+r()+".csv"}():function(){t=n.client.Acronym+" "+n.campaign.Name+" - "+n.source.DisplayName+" "+e.fileDate(n.start)+"-"+e.fileDate(n.end)+" "+r()+".csv"}()}(),t}();return{headers:o,filename:r}}var t=["isDuplicate","isDuplicateWithinFile","isInvalid"];return{prepareFileForDownload:n}}angular.module("download").factory("DownloadFileService",e),e.$inject=["DateFormat"]}(),function(){function e(e,n,t,o){function r(){h.create=!0,h.add=!1,h.push=!1}function a(){h.add=!0,h.create=!1,h.push=!1}function c(){h.add=!1,h.create=!1,h.push=!0}function i(){h.customListName&&(h.list.Name=h.customListName),o.createDataset(h.list).then(function(e){h.datasetCreatedMessage=e.dataset.Name+" Created successfully",h.list=e.list,l()}).catch(function(e){console.log(e)})}function s(){o.addListToDataset(h.selectedDataset,h.selectedList).then(function(e){h.datasetCreatedMessage=h.selectedList.Count+" Records Added to Dataset: "+h.selectedDataset.Name,l()}).catch(function(e){console.log(e)})}function u(e){h.selectedDataset=h.datasets[e]}function l(){o.retrieveDatasets().then(function(e){e.forEach(d),h.datasets=e}).catch(function(e){console.log(e)})}function d(e){var n=0;e.List.forEach(function(e){n+=e.Count}),e.count=n}function f(){o.pushRecords(h.datasetToPush).then(function(e){h.datasetCreatedMessage=e.n+" Records pushed to Contact Space",h.datasetToPush.isExported=!0,console.log(e)}).catch(function(e){console.log(e)})}function p(){h.datasetCreatedMessage=""}function m(){n.close()}var h=this;h.campaign=e.Campaign,h.client=e.Client,h.showCreate=r,h.showAdd=a,h.showPush=c,h.createDataset=i,h.addListTodataset=s,h.selectDataset=u,h.pushRecords=f,h.closeModal=m,h.closeAlert=p,function(){h.unexportedLists=h.campaign.Lists.filter(function(e){return!e.isExported}),l()}(),t.$on("closeModal",function(e){m()})}angular.module("export").controller("ExportController",e),e.$inject=["data","$uibModalInstance","$rootScope","ExportService"]}(),function(){function e(e,n,t,o,r){function a(){function n(){m.campaign.Lists=m.campaign.Lists.map(o.setTimestamp)}e.authenticate(),m.isLoading=!0,function(){function e(e){m.campaign=e.campaign,m.client=e.client,m.isLoading=!1}function o(){m.campaign.Lists=m.campaign.Lists.filter(function(e){return!e.isExported})}return t.getCampaign().then(e).then(n).then(o)}().then(s).catch(p)}function c(e,n){function t(){m.selectedLists.length>0&&(m.customListName=m.selectedLists[0].Name),function(){function e(e){n+=e.Count}var n=0;m.selectedLists.forEach(e),m.customListName=m.customListName.replace(/\(\d+\)/,"("+n+")")}(),function(){function e(e){var t=e.Name.match(/\[.+\]/)[0].replace("[","").replace("]","");-1===n.indexOf(t)&&-1===m.customListName.indexOf(t)&&n.push(t)}var n=[];m.selectedLists.forEach(e);var t=function(){return m.customListName.match(/\[.+\]/)[0].replace("[","").replace("]","")}();!function(e){m.customListName=m.customListName.replace(/\[.+\]/,e)}(function(){return n.length>1?"[Combined]":n.length>0?"["+t+" | "+n.join(" | ")+"]":"["+t+"]"}())}()}n?function(e){m.selectedLists.push(e),console.log(m.selectedLists),t()}(e):function(e){m.selectedLists.splice(m.selectedLists.indexOf(e),1),t()}(e)}function i(){function e(e){m.success=e.dataset.Name+" Created successfully",m.selectedLists=[],m.customListName="",a()}var n=m.customListName||m.list.Name,t={lists:m.selectedLists.map(function(e){return delete e.timestamp,e}),name:n};r.createDataset(t).then(e).then(s).catch(p)}function s(){function e(e){function n(e){var n=0;e.List.forEach(function(e){n+=e.Count}),e.count=n}e.forEach(n),m.datasets=e}return r.retrieveDatasets().then(e).catch(p)}function u(){function e(e){var n=function(){var e=0;return m.selectedLists.forEach(function(n){e+=n.Count}),e}();m.selectedLists=[],a();var t=m.dataset.Name;m.setState("add"),m.success=n+" Records Added to Dataset: "+t,m.dataset=""}m.selectedLists.length<1||r.addListToDataset(m.dataset,m.selectedLists).then(e).catch(p)}function l(e){r.deleteDataset(e).then(function(e){m.success="Dataset "+e.Name+" was successfully deleted",a()}).catch(p)}function d(e,n){function t(n){m.state[n]=n===e}m.dataset=n,m.success="",m.error="",Object.keys(m.state).forEach(t)}function f(e){m.sortKey=e,m.sortKey===e&&(m.reverse=!m.reverse)}function p(e){console.log(e),m.isLoading=!1}var m=this;m.nav=n,m.state={create:!0,add:!1,push:!1,showLists:!1},m.selectedLists=[],m.selectedClass="selected",m.setSelectedList=c,m.setState=d,m.sort=f,m.createDataset=i,m.addListTodataset=u,m.deleteDataset=l,a()}angular.module("export").controller("ExportCtrl",e),e.$inject=["authentication","Navigation","SingleCampaignService","DateFormat","ExportService"]}(),function(){function e(e,n,t){function o(){var n=e.defer();return s.get(t,function(e){e.error?n.reject(e.error):n.resolve(e.data)}),n.promise}function r(n,o){var r=e.defer(),a=new s({Dataset:n,Lists:o});return s.update(t,a,function(e){e.error?r.reject(e.error):r.resolve(e.data)}),r.promise}function a(n){var o=e.defer(),r=new s({Dataset:n});return s.patch(t,r,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function c(n){var o=e.defer();return new s({Config:n}).$save(t,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function i(n){var o=e.defer(),r=angular.copy(t);return r.Dataset=n._id,s.delete(r,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}var s=n("/api/:acronym/:path/export",{acronym:"@Acronym",path:"@Path"},{update:{method:"PUT"},patch:{method:"PATCH"}});return{createDataset:c,retrieveDatasets:o,addListToDataset:r,pushRecords:a,deleteDataset:i}}angular.module("export").factory("ExportService",e),e.$inject=["$q","$resource","$routeParams"]}(),function(){function e(e,n,t,o,r){function a(){function e(e){function n(n){n._id===e._id&&(n.disabled=!0)}m.files.forEach(n)}r.retrieveAllFiles().then(function(n){m.files=n.all,n.listFiles.forEach(e)}).catch(function(e){console.log(e)})}function c(){m.viewFileDetails=!1}function i(e){r.retrieveFileDetails(e).then(function(e){m.fileInfo=e,m.viewFileDetails=!0}).catch(function(e){console.log(e)})}function s(){m.selectedFile={},m.confirmDelete=!1}function u(e){m.selectedFile={id:e},m.confirmDelete=!0}function l(){r.deleteFile(m.selectedFile.id).then(function(e){m.campaign=e,a(),m.confirmDelete=!1}).catch(function(e){console.log(e),m.confirmDelete=!1})}function d(){n.close()}function f(){m.deleteMessage=""}function p(e){m.sortKey=e,console.log(e),m.sortKey===e&&(m.reverse=!m.reverse)}var m=this;m.campaign=o.Campaign,m.files=[],m.closeAlert=f,m.closeModal=d,m.sort=p,m.selectFileForDeletion=u,m.selectedFile={},m.cancelDeletion=s,m.delete=l,m.retrieveFileDetails=i,m.back=c,m.confirmDelete=!1,m.viewFileDetails=!1,function(){a()}(),t.$on("closeModal",function(e){d()})}angular.module("files").controller("FilesController",e),e.$inject=["$scope","$uibModalInstance","$rootScope","data","FileService"]}(),function(){function e(e,n,t,o,r){function a(){function e(){function e(e){d.fileinfo=e,d.files=e.all,d.isLoading=!1}function t(){function e(e){function n(n){n._id===e._id&&(n.disabled=!0)}d.files.forEach(n)}d.fileinfo.listFiles.forEach(e)}n.retrieveAllFiles().then(e).then(t)}o.authenticate(),d.isLoading=!0,function(){function e(e){d.campaign=e.campaign,d.client=e.client}return r.getCampaign().then(e)}().then(e).catch(l)}function c(){n.deleteFile(d.selectedFile._id).then(function(e){d.success=d.selectedFile.Name+" Has been successfully deleted",d.confirmDelete=!1,a()}).catch(function(e){d.confirmDelete=!1})}function i(){d.selectedFile={},d.confirmDelete=!1}function s(e){d.success="",d.selectedFile=e,d.confirmDelete=!0}function u(e){d.sortKey=e,d.sortKey===e&&(d.reverse=!d.reverse)}function l(e){console.log(e)}var d=this;d.nav=t,d.fileSources=[],d.fileLists=[],d.selectedFile={},d.selectFileForDeletion=s,d.cancelDeletion=i,d.delete=c,d.sort=u,a()}angular.module("files").controller("FilesCtrl",e),e.inject=["$q","FileService","Navigation","authentication","SingleCampaignService"]}(),function(){function e(e,n,t){function o(){var e=t.defer();return c.get(n,function(n){n.error?e.reject(n.error):e.resolve(n.data)}),e.promise}function r(e){var o=t.defer();return new c({File:e}).$save(n,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function a(e){var o=t.defer(),r=(new c({File:e}),angular.copy(n));return r.File=e,c.delete(r,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}var c=e("/api/:acronym/:path/files",{path:"@path",acronym:"@acronym"});return{deleteFile:a,retrieveFileDetails:r,retrieveAllFiles:o}}angular.module("files").factory("FileService",e),e.$inject=["$resource","$routeParams","$q"]}(),function(){function e(e,n,t,o){function r(){return t.retrieveHeaders(v.campaign.Path).then(function(e){console.log(e),c(e,a(e[0]))}).catch(function(e){console.log(e)})}function a(e){var n=[];for(var t in e)"OriginalFile"===t?n.splice(0,0,t):"__v"!==t&&"Campaign"!==t&&"Client"!==t&&n.push(t);return n}function c(e,n){var t=[];e.forEach(function(e){var o=[];n.forEach(function(n){void 0===e[n]?o.push(""):"OriginalFile"===n?o.push(e[n].Name):o.push(e[n])}),t.push(o)}),v.tableData=t,v.keys=n}function i(e){var n=v.tableData.filter(function(n){return n[1]===e})[0];console.log(n),s(n,v.keys),t.getSingleHeader(v.row._id).then(function(e){v.files=e}).catch(function(e){console.log(e)})}function s(e,n){var t={};n.forEach(function(n,o){t[n]=e[o]}),v.row=t}function u(){v.delete=!0}function l(e){v[e]=!1}function d(){t.deleteHeader(v.selectedHeader._id).then(function(e){r(),v.deleteMessage="Header Mapping Successfully Deleted",v.delete=!1,f()}).catch(function(e){console.log(e)})}function f(){v.row=""}function p(){v.update=!0}function m(){e.close()}function h(){v.deleteMessage=""}function g(e){v.sortKey=e,console.log(e),v.sortKey===e&&(v.reverse=!v.reverse)}var v=this;v.campaign=n.Campaign,v.selectRow=i,v.confirmDelete=u,v.deleteHeaderMap=d,v.hideSection=l,v.cancel=f,v.showUpdate=p,v.sort=g,v.closeModal=m,v.closeAlert=h,function(){r()}(),o.$on("closeModal",function(e){m()})}angular.module("header").controller("HeaderController",e),e.$inject=["$uibModalInstance","data","HeaderMapService","$rootScope"]}(),function(){function e(e,n,t,o){function r(){function n(e){!function(e,n){function t(e){function t(n){e[n]?r.push(e[n].Name||e[n]):r.push("")}var r=[];n.forEach(t),o.push(r)}var o=[];e.forEach(t),f.tableData=o,f.keys=n}(e,function(e){function n(e){"OriginalFile"===e?t.splice(0,0,e):-1===o.indexOf(e)&&t.push(e)}var t=[],o=["__v","Campaign","Client","_id"];return Object.keys(e).forEach(n),t}(e[0]))}return console.log("Retrieving headers"),e.retrieveHeaders(f.campaign.Path).then(n).catch(function(e){console.log(e)})}function a(n){function t(e){return e[1]===n}!function(e,n){function t(n,t){o[n]=e[t]}var o={};n.forEach(t),f.selectedHeader=o}(f.tableData.filter(t)[0],f.keys),e.getSingleHeader(f.row._id).then(function(e){f.files=e}).catch(d)}function c(){e.deleteHeader(f.selectedHeader._id).then(function(e){r(),f.success="Header Mapping Successfully Deleted",f.delete=!1,s()}).catch(function(e){console.log(e)})}function i(){f.delete=!0}function s(){f.selectedHeader=""}function u(){f.delete=!1}function l(e){f.sortKey=e,f.sortKey===e&&(f.reverse=!f.reverse)}function d(e){console.log(e)}var f=this;f.nav=t,f.sort=l,f.selectRow=a,f.deleteHeaderMap=c,f.confirmDelete=i,f.cancel=s,f.cancelDelete=u,function(){n.authenticate(),f.isLoading=!0,function(){function e(e){f.campaign=e.campaign,f.client=e.client}return o.getCampaign().then(e).catch(d)}().then(r).then(function(){f.isLoading=!1})}()}angular.module("header").controller("HeaderCtrl",e),e.inject=["HeaderMapService","authentication","Navigation","SingleCampaignService"]}(),function(){function e(e,n,t){function o(t){var o=e.defer();return c.get(n,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function r(n){var t=e.defer();return i.get({header_id:n},function(e){e.error?t.reject(e.error):t.resolve(e.data)}),t.promise}function a(t){var o=e.defer();return n.header_id=t,i.delete(n,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}var c=t("/api/:acronym/:path/edit-header",{acronym:"@acronym",path:"@path",header_id:"@_id"}),i=t("/api/:acronym/:path/edit-header/:header_id",{acronym:"@acronym",path:"@Path",header_id:"@_id"});return{retrieveHeaders:o,getSingleHeader:r,deleteHeader:a}}angular.module("header").factory("HeaderMapService",e),e.$inject=["$q","$routeParams","$resource"]}(),function(){function e(e,n,t){function o(t){var o=n.defer();!function(){!function(){function e(e){n[e]&&(o[e]="$"+e)}var n=t.$group,o={};Object.keys(n).forEach(e),t.$group=o}(),function(){t.$group.Source&&(t.lookup1={from:"sources",localField:"_id.Source",foreignField:"_id",as:"_id.Source"},t.unwind1="$_id.Source",t.project1={_id:0}),t.$group.File&&(t.lookup2={from:"files",localField:"_id.File",foreignField:"_id",as:"_id.File"},t.unwind2="$_id.File")}()}();var r=angular.copy(e);return r.data=t,i.get(r,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function r(t){var o=n.defer();return new i(t).$save(e,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function a(){var o=t("/api/:acronym/:path/view-lists",{acronym:"@Acronym",path:"@Path"}),r=n.defer();return o.get(e,function(e){e.error?r.reject(e.error):r.resolve(e.data)}),r.promise}function c(t){var o=n.defer(),r=angular.copy(e);return r.data=t,i.delete(r,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}var i=t("/api/:acronym/:path/lists",{acronym:"@Acronym",path:"@Path"});return{sendRecordCountRequest:o,sendCreateListRequest:r,retrieveExistingLists:a,sendDeleteRequest:c}}angular.module("list").factory("ListService",e),e.$inject=["$routeParams","$q","$resource"]}(),function(){function e(e,n,t){function o(){console.log("firing"),n.sendDeleteRequest(c.list._id).then(function(n){e.close({list:c.list,modified:n.nModified})}).catch(function(e){console.log(e)})}function r(){e.dismiss()}function a(){c.deleteSuccess=""}var c=this;c.list=t.List,c.dismissModal=r,c.closeAlert=a,c.deleteList=o}angular.module("list").controller("DeleteListController",e),e.$inject=["$uibModalInstance","ListService","data"]}(),function(){function e(e,n,t,o,r,a){function c(){function e(e){var n=function(e){var n=function(e){function n(e){function n(n){function o(t,o){e[n]=o,e._id[n]=t}if("count"!==n)if("Source"===n){var r=t[n];o(r,r.DisplayName)}else if("File"===n){var a=t[n];o(a,a.Name)}else e[n]=t[n]||"";else e[n]=t[n]}var t=e._id;Object.keys(t).forEach(n)}return e.forEach(n),e}(e);return{rows:n,header:function(e){function n(e){"_id"!==e&&t.push(e)}var t=[];return Object.keys(e).forEach(n),function(e,n){e.push(e.splice(n,1)[0])}(t,t.indexOf("count")),t}(n[0])}}(e);$.rows=n.rows,$.header=n.header,$.query={}}t.sendRecordCountRequest($.query).then(e).catch(g)}function i(e,n){function t(n){-1===r.indexOf(n)&&(-1!==a.indexOf(n)?o[n]=e._id[n]:o[n]=e[n])}var o={},r=["count","$$hashKey","_id"],a=["File","Source"];return Object.keys(e).forEach(t),function(){o.isInvalid=!1,o.isExcluded=!1,o.List=null,o.isExported=!1}(),o}function s(e){function n(n){$.successMessage=n.listName+" Created with "+n.count+" Records",$.campaign=n.campaign,$.rows.splice($.rows.indexOf(e),1),$.isLoading=!1}$.isLoading=!0,t.sendCreateListRequest(function(){var n={};return n.search=i(e),n.count=angular.copy(e.count),n}()).then(n).catch(g)}function u(e){!function(e){o.searchRecords(e).then(l).catch(g)}(i(e))}function l(e){$.isLoading=!1,r.createModal({name:"Edit-Records",location:"core",size:"xxl",backdrop:"dynamic",resolve:{Records:e}}).result.then(function(e){console.log(e)})}function d(e){function n(e){$.lists.splice($.lists.indexOf(e.list),1),$.campaign.Lists=$.lists,$.successMessage=e.list.Name+" successfully removed with "+e.modified+" records altered"}var t=$.lists[e];r.createModal({name:"Delete-List",location:"lists",size:"lg-mid",backdrop:"static",resolve:{List:t}}).result.then(n)}function f(){function e(e){$.lists=e,$.header=function(e){function n(e){-1===o.indexOf(e)&&t.push(e)}var t=[],o=["__v","_id","Campaign","Created","Updated"];return Object.keys(e).forEach(n),t}(e[0])}t.retrieveExistingLists().then(e).catch(g)}function p(e,n){return!$.isArray(n)&&!$.isObject(n)&&"__v"!==e&&"_id"!==e&&"Campaign"!==e&&"Created"!==e&&"Updated"!==e}function m(e){return"[object Array]"===Object.prototype.toString.call(e)}function h(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function g(e){console.log(e),$.isLoading=!1}function v(){e.close($.campaign)}function S(){$.successMessage=""}function y(){$.isCreate=!0,$.isView=!1,$.selectedList="",$.successMessage=""}function C(){$.isView=!0,$.isCreate=!1,$.selectedList="",$.successMessage="",$.rows="",$.header="",f()}function w(e){$.sortKey=e,$.sortKey===e&&($.reverse=!$.reverse)}var $=this;$.campaign=n.Campaign,$.closeModal=v,$.query={},$.query.$group={},$.states=["NSW","VIC","ACT","QLD","WA","SA","NT","TAS"],$.genders=["Female","Male","None"],$.getRecordCounts=c,$.createList=s,$.showCreate=y,$.showView=C,$.viewRecords=u,$.deleteList=d,$.isObject=h,$.isArray=m,$.isPlainValue=p,$.closeAlert=S,$.sort=w,function(){$.isCreate=!0}(),a.$on("closeModal",function(){$.closeModal()}),a.$on("closeModal",function(e){v()})}angular.module("list").controller("ListsController",e),e.$inject=["$uibModalInstance","data","ListService","SearchService","ModalService","$rootScope"]}(),function(){function e(e,n,t,o){function r(){h.createLists=!h.createLists,h.createLists?h.success="":s()}function a(){function e(e){if(!(e.length<1)){var n=function(e){var n=function(e){function n(e){function n(n){function o(t,o){e[n]=o,e._id[n]=t}if("count"!==n)if("Source"===n){var r=t[n];o(r,r.DisplayName)}else if("File"===n){var a=t[n];o(a,a.Name)}else e[n]=t[n]||"";else e[n]=t[n]}var t=e._id;Object.keys(t).forEach(n)}return e.forEach(n),e}(e);return{rows:n,header:function(e){function n(e){"_id"!==e&&t.push(e)}var t=[];return Object.keys(e).forEach(n),function(e,n){e.push(e.splice(n,1)[0])}(t,t.indexOf("count")),t}(n[0])}}(e);h.rows=n.rows,h.header=n.header,h.query={}}}!function(){function e(e){n[e.name]=!0}h.query={};var n={};h.selectedAggregates.forEach(e),h.query.$group=n}(),o.sendRecordCountRequest(h.query).then(e).catch(m)}function c(e,n){function t(n){-1===r.indexOf(n)&&(-1!==a.indexOf(n)?o[n]=e._id[n]:o[n]=e[n])}var o={},r=["count","$$hashKey","_id"],a=["File","Source"];return Object.keys(e).forEach(t),function(){o.isInvalid=!1,o.isExcluded=!1,o.List=null,o.isExported=!1}(),o}function i(e){function n(n){h.success=n.listName+" Created with "+n.count+" Records",h.campaign=n.campaign,h.rows.splice(h.rows.indexOf(e),1),h.isLoading=!1}h.isLoading=!0,o.sendCreateListRequest(function(){var n={};return n.search=c(e),n.count=angular.copy(e.count),n}()).then(n).catch(m)}function s(){function e(e){h.lists=e,h.header=function(e){function n(e){-1===o.indexOf(e)&&t.push(e)}var t=[],o=["__v","_id","Campaign","Created","Updated"];return Object.keys(e).forEach(n),t}(e[0])}o.retrieveExistingLists().then(e).catch(m)}function u(e){o.sendDeleteRequest(e._id).then(function(n){h.success="List sucessfully removed with "+n.nModified+" Records affected",h.lists.splice(h.lists.indexOf(e),1)}).catch(function(e){console.log(e)})}function l(e,n){return!h.isArray(n)&&!h.isObject(n)&&"__v"!==e&&"_id"!==e&&"Campaign"!==e&&"Created"!==e&&"Updated"!==e}function d(e){return"[object Array]"===Object.prototype.toString.call(e)}function f(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function p(e){h.sortKey=e,h.sortKey===e&&(h.reverse=!h.reverse)}function m(e){console.log(e)}var h=this;h.createLists=!0,h.switchDisplay=r,h.createList=i,h.deleteList=u,h.nav=t,h.aggregateOptions=[{name:"State",ticked:!1},{name:"Gender",ticked:!1},{name:"File",ticked:!1},{name:"Source",ticked:!0}],h.selectedAggregates=[],h.getRecordCounts=a,h.isObject=f,h.isArray=d,h.isPlainValue=l,h.sort=p,function(){e.authenticate(),h.isLoading=!0,function(){function e(e){h.campaign=e.campaign,h.client=e.client}return n.getCampaign().then(e).catch(m)}().then(function(){h.isLoading=!1})}()}angular.module("list").controller("ListsCtrl",e),e.inject=["authentication","SingleCampaignService","Navigation","ListService"]}(),function(){function e(e,n,t,o,r){function a(e){f.sortKey=e,console.log(e),f.sortKey===e&&(f.reverse=!f.reverse)}function c(e){f.record=e,f.recordView=[];for(var n in f.record)"__v"!==n&&f.recordView.push(i(n,{},f.record[n]));f.recordView.sort(function(e,n){return e.key.localeCompare(n.key)})}function i(e,n,t){return n.key=e,-1!==p.indexOf(e)?(n.value=t.Name,n.isDisabled=!0,n.trueValue=t):-1!==h.indexOf(e)?(n.value=t,n.isDisabled=!0,n.trueValue=t):-1!==m.indexOf(e)?(n.value=t,n.isSelect=!0):n.value=t,n}function s(){f.record=""}function u(){var e={};f.recordView.forEach(function(n){n.isSelect?(console.log("select field: ",n),e[n.key]=!0===n.value):n.isDisabled?e[n.key]=n.trueValue:e[n.key]=n.value}),console.log("input: ",e),o.updateRecord(e).then(function(n){f.records=f.records.map(function(t){return t._id===e._id&&(t=n),t}),f.record="",f.updateSuccess="Record Successfully Updated"}).catch(function(e){console.log(e)})}function l(){e.dismiss("cancel")}function d(){f.updateSuccess=""}var f=this;f.records=n.Records,f.sort=a,f.ascending=[];var p=["Source","Campaign","Client","List"],m=["isDuplicate","isDuplicateWithinFile","isInvalid","isExcluded"],h=["_id","Filename","CustKey","OriginalCost"];f.selectRecord=c,f.saveEdit=u,f.goBack=s,f.exclude=["_id","isInvalid","__v","isDuplicate","isDuplicateWithinFile","isExcluded","Extra1","Extra2","Extra3"],f.disable=["_id"],f.closeAlert=d,f.closeModal=l}angular.module("search").controller("EditRecordsController",e),e.$inject=["$uibModalInstance","data","ModalService","SearchService","GeneralFuncService"]}(),function(){function e(e,n,t,o,r,a,c,i){function s(){u()}function u(){o.receiveClients().then(function(e){g.clients=e}).catch(function(e){console.log(e)})}function l(){var e={acronym:g.client.Acronym,path:g.selectedCampaign.Path};a.getCampaign(e).then(function(e){g.campaign=e.campaign}).catch(function(e){console.log(e)})}function d(){e.searchRecords(f()).then(function(e){p(e)})}function f(){var e={};return g.client&&(e.Client=g.client._id),g.campaign&&(e.Campaign=g.campaign._id),g.file&&(e.File=g.file._id),g.source&&(e.Source=g.source._id),g.list&&(e.List=g.list._id),g.start&&g.end&&(g.start.setHours(0,0,0),g.end.setHours(23,59,59),e.Created={$gt:g.start,$lt:g.end}),g.selected&&("isDuplicate"!==g.selected&&"isDuplicateWithinFile"!==g.selected&&"isInvalid"!==g.selected&&"isExcluded"!==g.selected||(e[g.selected]=!0),g.searchValue&&(e[g.selected]=g.searchValue)),e}function p(e){g.isLoading=!1,n.createModal({name:"Edit-Records",location:"search",backdrop:"dynamic",size:"xxl",resolve:{Records:e}}).result.then(function(e){console.log(e)})}function m(){i.logout()}function h(){c.close()}var g=this;g.title="search",g.searchOptions=["CustKey","isDuplicate","isDuplicateWithinFile","isInvalid","MobilePhone","HomePhone","Phone1","Phone2","Email","State"],g.showClient=s,g.getCampaign=l,g.search=d,g.logout=m,g.today=t.today,g.popup1={},g.popup2={},g.date={},g.open=t.open,g.closeModal=h}angular.module("search").controller("OldSearchRecordController",e),e.$inject=["SearchService","ModalService","DatePicker","ClientService","$routeParams","SingleCampaignService","$uibModalInstance","authentication"]}(),function(){function e(e,n,t,o,r,a){function c(){a.getAllCampaigns().then(function(e){l.campaigns=e.map(function(e){return e.DisplayName=e.Client.Acronym+" "+e.Name,e})})}function i(){e.path("/"+l.campaign.Client.Acronym+"/"+l.campaign.Path)}function s(){e.path("/search-records")}function u(){n.logout()}var l=this;l.title="search",l.isLoading=!1,l.logout=u,l.openSearchModal=s,l.redirectToCampaign=i,function(){l.isAuthenticated=n.isLoggedIn(),l.isAuthenticated&&c()}()}angular.module("search").controller("SearchController",e),e.$inject=["$location","authentication","$window","SearchService","ModalService","CampaignService"]}(),function(){function e(e,n,t){function o(e){var t=n.defer(),o={query:e};return a.get(o,function(e){e.error?t.reject(e.error):t.resolve(e.data)}),t.promise}function r(e){e.Updated=new Date;var t=n.defer();return new a(e).$save(function(e){e.error?t.reject(e.error):t.resolve(e.data)}),t.promise}var a=e("/api/search",{},{get:{method:"GET",headers:{Authorization:t.setAuth}}});return{searchRecords:o,updateRecord:r}}angular.module("search").factory("SearchService",e),e.$inject=["$resource","$q","authentication"]}(),function(){function e(e,n,t,o,r,a){function c(){function e(e){s(h.record[e])?h.record[e].select&&(n[e]="true"===h.record[e].bool):n[e]=h.record[e]}var n={};Object.keys(h.record).forEach(e),r.updateRecord(h.record._id.value,n).then(function(e){var n=h.records.filter(function(n){return n._id===e._id})[0];h.records[h.records.indexOf(n)]=e,i(e)})}function i(e){function n(e){s(h.record[e])&&(h.record[e]={disabled:!0,value:h.record[e].DisplayName||h.record[e].Name||h.record[e]._id}),"is"===e.slice(0,2).toLowerCase()&&(h.record[e]={select:!0,bool:String(h.record[e])},console.log(h.record[e])),-1!==t.indexOf(e)&&(h.record[e]={disabled:!0,value:a.createTimestamp(h.record[e])}),-1!==o.indexOf(e)&&(h.record[e]={disabled:!0,value:h.record[e]})}h.record=angular.copy(e);var t=["Created","Updated"],o=["CustKey","OriginalCost","_id","__v"];Object.keys(h.record).forEach(n)}function s(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function u(){h.showRecords=!1,h.records=""}function l(){h.query={Range:{start:new Date,end:new Date},search:{}}}function d(e){h.errorMessage="",""===e?h.query.search={}:h.query.search.selectedField=e,h.status.includes(e)?h.disableText=!0:h.disableText=!1}function f(){n.receiveClients().then(function(e){h.clients=e}).catch(function(e){console.log(e)})}function p(){h.showRecords=!0,function(){function e(e){0===Object.keys(h.query[e]).length&&delete h.query[e]}function n(e){-1!==t.indexOf(e)&&(h.query[e]=h.query[e]._id)}var t=["Client","Campaign","File","Source","List"];return function(){h.query.Range.start.setHours(0,0,0,0),h.query.Range.end.setHours(23,59,59,59)}(),Object.keys(h.query).forEach(n),Object.keys(h.query).forEach(e),!h.query.search||function(){return!(!h.disableText&&!h.query.search.searchText)||(h.errorMessage="This field cannot be blank!",!1)}()}()&&r.searchRecords(h.query).then(function(e){l(),h.records=e}).catch(function(e){console.log(e)})}function m(e){h.sortKey=e,h.sortKey===e&&(h.reverse=!h.reverse)}var h=this;h.today=t.today,h.disableText=!1,h.showRecords=!1,h.phone=["Phone1","Phone2","MobilePhone","HomePhone"],h.address=["Address1","Address2","Suburb","State","Postcode"],h.status=["isDuplicate","isDuplicateWithinFile","isInvalid","isExported"],h.options=["true","false"],h.handle=d,h.popup1={},h.popup2={},h.date={},h.open=t.open,h.searchRecords=p,h.selectRecord=i,h.showSearch=u,h.saveRecord=c,h.sort=m,function(){o.authenticate(),l(),f()}()}angular.module("searchRecords").controller("SearchRecordsCtrl",e),e.$inject=["$location","ClientService","DatePicker","authentication","QueryRecords","DateFormat"]}(),function(){function e(e){e.when("/search-records",{templateUrl:"/searchrecords/client/views/search.records.client.view.html",controllerAs:"vm"})}angular.module("searchRecords").config(e),e.$inject=["$routeProvider"]}(),function(){function e(e,n,t){function o(e){var t=n.defer();return a.get(e,function(e){e.error?t.reject(e.error):t.resolve(e.data)}),t.promise}function r(e,t){t.Updated=new Date,console.log(t);var o=n.defer();return new a({id:e,update:t}).$save(function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}var a=t("/api/search-records",{},{});return{searchRecords:o,updateRecord:r}}angular.module("searchRecords").factory("QueryRecords",e),e.$inject=["$rootScope","$q","$resource"]}(),function(){function e(e,n,t){function o(){e.loadSourceMaps().then(function(e){u.sourcemaps=e,r()}).catch(function(e){console.log(e)})}function r(){u.sources=u.sourcemaps.map(function(e){return e.Source})}function a(){u.maps=u.sourcemaps.filter(function(e){if(e.Source===u.source)return e})}function c(n){e.deleteSourceMap(n).then(function(e){u.success.message="Source map Deleted",u.sourcemaps=u.sourcemaps.filter(function(n){return n._id!==e._id}),u.maps={},r(),a()}).catch(function(e){console.log(e)})}function i(){t.close()}function s(){u.success.message=""}var u=this;u.campaign=n,u.success={},u.deleteMap=c,u.displayMaps=a,u.closeAlert=s,u.closeModal=i,function(){o()}()}angular.module("sourcemaps").controller("SourcemapsController",e),e.$inject=["SourcemapService","data","$uibModalInstance"]}(),function(){function e(e,n,t){function o(){var e=n.defer();return a.get(t,function(n){n.error?e.reject(n.error):e.resolve(n.data)}),e.promise}function r(e){var o=n.defer(),r=angular.copy(t);return r.map=e,a.delete(r,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}var a=new e("/api/:acronym/:path/sourcemaps");return{loadSourceMaps:o,deleteSourceMap:r}}angular.module("sourcemaps").factory("SourcemapService",e),e.$inject=["$resource","$q","$routeParams"]}(),function(){function e(e,n,t,o,r,a,c){function i(e){e.$valid&&r.editSource(f.source).then(s).catch(function(e){f.error=a.handleError(e,f.Name),f.source=o.Source})}function s(e){n.close(e)}function u(){n.close()}function l(){f.error=""}function d(){f.showOverwrite=!f.showOverwrite}var f=this;f.source=angular.copy(o.Source),f.Name="Source",f.types=["Stand Alone","Grid","Phone Leads"],f.today=c.today,f.popup1={},f.popup2={},f.start={},f.end={},f.open=c.open,f.showOverwrite=!1,f.toggleOverwrite=d,f.goBack=s,f.closeModal=u,f.editSource=i,f.closeAlert=l}angular.module("sources").controller("EditSourceController",e),e.$inject=["$location","$uibModalInstance","ModalService","data","SourceService","ErrorHandler","DatePicker"]}(),function(){function e(e,n,t,o,r){function a(){e.close()}function c(){l.showResult=!1,l.start&&(l.date.start=o.formatDate(l.start)),l.end&&(l.date.end=o.formatDate(l.end)),l.start&&l.end&&(l.allowOverwrite=!0)}function i(){l.showResult=!0,r.overwriteCost(l.source,l.start,l.end).then(function(e){l.success=e.nModified+" Records updated successfully"}).catch(function(e){l.error="Something happened to my head: "+e})}function s(){l.success=""}function u(){l.error=""}var l=this;l.source=angular.copy(t.Source),l.campaign=angular.copy(t.Campaign),l.Name="Source",l.types=["Stand Alone","Grid","Phone Leads"],l.today=n.today,l.popup1={},l.popup2={},l.date={},l.open=n.open,l.setDates=c,l.allowOverwrite=!1,l.overwriteCost=i,l.closeSuccess=s,l.closeError=u,l.closeModal=a}angular.module("sources").controller("OverwriteCostController",e),e.$inject=["$uibModalInstance","DatePicker","data","DateFormat","SourceService"]}(),function(){function e(e,n,t,o,r,a,c){function i(){C.campaign.Source=C.campaign.Sources.map(a.setTimestamp)}function s(e){r.createModal({location:"sources",name:"Edit-Source",size:"lg-mid",resolve:{Source:C.campaign.Sources.filter(function(n){return n._id===e})[0]}}).result.then(l)}function u(e){r.createModal({location:"sources",name:"Overwrite-Cost",size:"lg-mid",resolve:{Source:C.campaign.Sources.filter(function(n){return n._id===e})[0],Campaign:C.campaign}}).result.then(l)}function l(e){e&&(e.isDismissed?n.dismiss():(C.campaign.Sources=d(e),C.success.message=e.DisplayName+" successfully updated"))}function d(e){return C.campaign.Sources.map(function(n){return n._id===e._id&&(n=a.setTimestamp(e)),n})}function f(e){C.source.Campaign=C.campaign._id,e.$valid&&o.postSource(C.source).then(p).catch(h),e.$setPristine()}function p(e){C.source={},C.campaign.Sources.push(a.setTimestamp(e.source))}function m(){r.createModal({location:"sourcemaps",name:"Sourcemaps",resolve:{Campaign:C.campaign}}).result.then(l)}function h(e){console.log(e)}function g(){C.showAdd=!C.showAdd}function v(){n.close()}function S(){C.success.message=""}function y(e){C.sortKey=e,console.log(e),C.sortKey===e&&(C.reverse=!C.reverse)}var C=this;C.types=["","Stand Alone","Grid","Phone Leads"],C.source={},C.showAdd=!1,C.showSource=g,C.campaign=t.Campaign,C.client=t.Client,C.success={},C.sort=y,C.addsource=f,C.closeModal=v,C.EditSourceModal=s,C.OverWriteCostModal=u,C.openSourcemapmodal=m,C.closeAlert=S,function(){C.campaign.Sources.sort(function(e,n){return e.Name.localeCompare(n.Name)}),i()}(),c.$on("closeModal",function(e){v()})}angular.module("sources").controller("SourcesController",e),e.$inject=["$location","$uibModalInstance","data","SourceService","ModalService","DateFormat","$rootScope"]}(),function(){function e(e,n,t,o,r,a,c,i){function s(e){function n(e){y.source={},y.campaign.Sources.push(o.setTimestamp(e.source)),y.setState("list"),y.success="Source Created Successfully!"}y.source.Campaign=y.campaign._id,e.$valid&&r.postSource(y.source).then(n).catch(S),e.$setPristine()}function u(e){function n(e){var n=y.campaign.Sources.indexOf(e);y.campaign.Sources[n]=e,y.source={},m("list"),y.success="Source Updated Correctly!"}e.$valid&&r.editSource(y.source).then(n).catch(function(e){y.error=a.handleError(e,y.Name)})}function l(){y.showResult=!0,r.overwriteCost(y.source,y.start,y.end).then(function(e){m("list"),y.success=e.nModified+" Records updated successfully"}).catch(function(e){y.error="Something happened to my head: "+e})}function d(){y.maps=y.sourcemaps.filter(function(e){if(e.Source===y.source)return e})}function f(e){i.deleteSourceMap(e).then(function(e){y.success="Source map deleted successfully!",y.sourcemaps=y.sourcemaps.filter(function(n){return n._id!==e._id}),y.maps={},p(),d()}).catch(function(e){console.log(e)})}function p(){y.sources=y.sourcemaps.map(function(e){return e.Source})}function m(e){function n(n){y.state[n]=n===e}y.success="",y.error="",Object.keys(y.state).forEach(n)}function h(e){y.source=e,m("editing")}function g(e){y.source=e,m("overwrite")}function v(e){y.sortKey=e,y.sortKey===e&&(y.reverse=!y.reverse)}function S(e){console.log(e)}var y=this;y.nav=n,y.types=["","Stand Alone","Grid","Phone Leads"],y.state={editing:!1,list:!0,creating:!1,overwrite:!1,sourcemaps:!1},y.today=c.today,y.popup1={},y.popup2={},y.date={},y.start=new Date,y.end=new Date,y.open=c.open,y.addSource=s,y.editSource=u,y.overwriteCost=l,y.displayMaps=d,y.deleteMap=f,y.setState=m,y.showEdit=h,y.showOverwrite=g,y.sort=v,function(){function n(){i.loadSourceMaps().then(function(e){y.sourcemaps=e,p()}).catch(function(e){console.log(e)})}function r(){y.campaign.Sources=y.campaign.Sources.map(o.setTimestamp)}t.authenticate(),y.isLoading=!0,function(){function n(e){y.campaign=e.campaign,y.client=e.client}return e.getCampaign().then(n).catch(S)}().then(n).then(function(){y.isLoading=!1,y.campaign.Sources.sort(function(e,n){return e.Name.localeCompare(n.Name)}),r()})}()}angular.module("sources").controller("SourcesCtrl",e),e.$inject=["SingleCampaignService","Navigation","authentication","DateFormat","SourceService","ErrorHandler","DatePicker","SourcemapService"]}(),function(){function e(e,n,t){function o(){var e=t.defer();return i.get(n,function(n){n.error?e.reject(n.error):e.resolve(n.data)}),e.promise}function r(e){var o=t.defer();return new i(e).$save(n,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function a(e){var o=t.defer(),r=new i({Source:e});return i.update(n,r,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function c(o,r,a){var c=t.defer();return new(e("/api/:acronym/:path/sources/cost"))({Source:o,Start:r,End:a}).$save(n,function(e){e.error?c.reject(e.error):c.resolve(e.data)}),c.promise}var i=e("api/:acronym/:path/sources",{acronym:"@Acronym",path:"@Path"},{update:{method:"PUT"}});return{postSource:r,getSources:o,editSource:a,overwriteCost:c}}angular.module("sources").factory("SourceService",e),e.$inject=["$resource","$routeParams","$q"]}(),function(){function e(e){e.when("/:acronym/:path/upload",{templateUrl:"/upload/client/views/upload-page.client.view.html",controllerAs:"vm",client_id:"@acronym",campaign_id:"@path"}).when("/:acronym/:path/download",{templateUrl:"/download/client/views/download-page.client.view.html",controllerAs:"vm",client_id:"@acronym",campaign_id:"@path"}).when("/:acronym/:path/lists",{templateUrl:"/lists/client/views/lists-page.client.view.html",controllerAs:"vm",client_id:"@acronym",campaign_id:"@path"}).when("/:acronym/:path/sources",{templateUrl:"/sources/client/views/sources-page.client.view.html",controllerAs:"vm",client_id:"@acronym",campaign_id:"@path"}).when("/:acronym/:path/headers",{templateUrl:"/header/client/views/header-page.client.view.html",controllerAs:"vm",client_id:"@acronym",campaign_id:"@path"}).when("/:acronym/:path/files",{templateUrl:"/files/client/views/files-page.client.view.html",controllerAs:"vm",client_id:"@acronym",campaign_id:"@path"}).when("/:acronym/:path/export",{templateUrl:"/export/client/views/export-page.client.view.html",controllerAs:"vm",client_id:"@acronym",campaign_id:"@path"})}angular.module("upload").config(e),e.$inject=["$routeProvider"]}(),function(){function e(e,n,t,o,r,a,c){function i(){function e(e){e.Source&&-1===n.indexOf(e.Source)&&(e.Source.Name||n.push(e.Source))}var n=[];return h.rows.forEach(e),n}function s(){function e(e){h.existingSources=i(),h.showMap=!0,h.success=e.length+" Source maps created successfully",h.sourcesSet=0===h.existingSources.length}h.canMap?c.saveSourceMap({map:function(){function e(e,t){var o={Name:h.existingSources[t],Source:e,Campaign:h.campaign};n.push(o)}var n=[];return h.sourceMapping.forEach(e),function(e){function n(e){function n(n){n.Source===e.Name&&(n.Source=e.Source,n.OriginalCost=e.Source.Cost)}h.rows.forEach(n)}e.forEach(n)}(n),n}()}).then(e).catch(l):function(){function e(e){return e.Source=h.selectedSource,e.OriginalCost=h.selectedSource.Cost,e}h.selectedSource&&(h.rows=h.rows.map(e),function(){h.showMap=!0,h.success="All Sources Set to: "+h.selectedSource.DisplayName,o.sourcesSet=!0,h.sourcesSet=!0}())}()}function u(e){function n(e){h.source={},h.campaign.Sources.push(a.setTimestamp(e.source))}h.source.Campaign=h.campaign._id,e.$valid&&r.postSource(h.source).then(n).catch(l),e.$setPristine()}function l(e){console.log(e)}function d(){h.showAdd=!h.showAdd}function f(){n.close(o)}function p(){o.sourcesSet=0===i().length,n.close(o)}function m(){h.success=""}var h=this;h.source={},h.campaign=o.Campaign,h.campaign.Sources.sort(function(e,n){return e.Name.localeCompare(n.Name)}),h.client=o.Client,h.types=["","Stand Alone","Grid","Phone Leads"],h.rows=o.Rows,h.filename=o.Filename,h.showMap=!1,h.sourceMapping=[],h.saveSourceMap=s,h.goBack=f,h.closeModal=p,h.setAllSource=s.setAllSourcesToSingleSource,h.closeAlert=m,h.showAdd=!1,h.showSource=d,h.addsource=u,function(){h.existingSources=i(),h.canMap=h.existingSources.length>0}()}angular.module("upload").controller("UploadSourceController",e),e.$inject=["$location","$uibModalInstance","ModalService","data","SourceService","DateFormat","SourceUploadService"]}(),function(){function e(e,n,t,o,r,a,c,i,s){function u(){t.getSourceMaps().then(function(e){L.maps=e}).catch(M)}function l(){function e(e){!function(){L.json_data=e.Rows,L.client=e.Client,L.campaign=e.Campaign,L.sourcesSet=e.sourcesSet}(),u(),h(),e.sourcesSet&&(L.canDownload=!1)}c.createModal({location:"upload",name:"Upload-Source",size:"lg-mid",resolve:{Rows:L.json_data||L.rows,Campaign:L.campaign,Client:L.client,Filename:L.file.name}}).result.then(e)}function d(){function e(e){L.header=e[0],L.rows=e,L.display.rows=e.slice(1,10)}function n(){return o.checkHeader(L.header)}function r(){L.selectedHeaders=[],L.headerMap={},L.completeMap=!1}function a(){L.json_data&&(L.showTable=!1)}function c(){L.duplicateError="",L.successMessage="",L.fileExistsMessage=""}g(),L.file&&(L.sourcesSet=!1,!function(){return!t.filenameExists(L.campaign.Files,L.file.name)}()?(L.fileExistsMessage="This file has already been uploaded!",g()):(L.isLoading=!0,o.readFile(L.file).then(e).then(n).then(p).then(m).then(r).then(a).then(c).then(f).catch(M)))}function f(){L.isLoading=!1}function p(e){return e.match?(L.header=e.header.header,L.header_id=e.header.headerObj._id,L.rows[0]=e.header.header,L.showTable=!1):(L.showTable=!0,L.tableRecords="",L.json_data=""),e.match}function m(e){function n(e){return!(void 0===e.MobilePhone&&void 0===e.HomePhone)}if(e){var t=r.unparse(L.rows),o=r.parse(t,{header:!0});L.json_data=o.data.filter(n),h(),L.records=L.json_data}}function h(){function e(e){function t(t){t.Source===e.Name&&(t.Source=e.Source,t.OriginalCost=e.Source.Cost,n++)}L.json_data.forEach(t)}var n=0;L.maps.forEach(e),function(){n===L.json_data.length?(L.sourcesSet=!0,L.canDownload=!1):(L.canDownload=!0,L.completeMap=!1)}()}function g(){L.showTable=!1,L.tableRecords=""}function v(){function e(e){return{header:e.header,headerObj:e.header.headerObj,match:!0}}L.isLoading=!0,function(){if(!L.selectedHeaders||!L.header)throw new Error("Header mapping not created!");L.headerMap=o.createMap(L.selectedHeaders,L.header)}(),!function(){return o.getMapLength(L.headerMap)===L.header.length}()?L.duplicateError="You have a duplicate in your header mapping! Please check what you have selected.":(L.duplicateError="",o.postHeaderMap(L.headerMap).then(e).then(p).then(m).then(f).catch(M))}function S(){L.completeMap=o.isMapComplete(L.selectedHeaders,L.header)}function y(){function e(e){L.successMessage=L.file.name+" uploaded successfully! "+e.response.count+" records uploaded with "+e.response.dupes+" duplicate records and "+e.response.dupesWithinFile+" Duplicates within the file.",L.campaign=e.campaign,L.sourcesSet="",g()}function o(){return n.getRecordCount()}function r(e){L.count=e}L.json_data&&(L.isLoading=!0,t.postRecords(L.json_data,L.file.name,L.header_id).then(e).then(o).then(r).then(f).catch(M))}function C(e){function n(e){"__v"!==e&&L.recordView.push(function(e,n,t){return n.key=e,"Source"===e&&void 0!==L.record.Source.Name?(n.value=L.record[e].DisplayName,n.isDisabled=!0):n.value=t,n}(e,{},L.record[e]))}L.record=e,L.recordView=[],Object.keys(L.record).forEach(n),function(e){e.sort(function(e,n){return e.key.localeCompare(n.key)})}(L.recordView)}function w(){function e(e){n[e.key]=e.value}var n={};L.recordView.forEach(e),L.tableRecords[L.index]=n,L.record="",L.updateSuccess="Record Successfully Updated"}function $(){}function M(e){console.log(e)}function b(e){L.sortKey=e,L.sortKey===e&&(L.reverse=!L.reverse)}function D(){L.updateSuccess="",L.duplicateError=""}function j(){L.record=""}var L=this;L.campaign={},L.client={},L.universalHeaders=[],L.headerMap={},L.file={},L.header={},L.rows={},L.display={},L.showTable=!1,L.selectedHeaders=[],L.completeMap=!1,L.canDownload=!1,L.selectRecord=C,L.saveEdit=w,L.goBack=j,L.ascending=[],L.sort=b,L.isLoading=!1,L.closeAlert=D,L.uploadFileToBrowser=d,L.postMap=v,L.checkMapIsComplete=S,L.submitRecords=y,L.closeModal=$,L.sourceUploadModal=l,function(){!function(){function e(e){L.campaign=e.campaign,L.client=e.client}n.getCampaign().then(e).catch(M)}(),function(){function e(e){L.universalHeaders=e}o.getUniversalHeaders().then(e).catch(M)}(),u()}(),s.$on("closeModal",function(e){})}angular.module("upload").controller("UploadController",e),e.$inject=["$location","SingleCampaignService","UploadService","HeaderService","Papa","NgTableParams","ModalService","GeneralFuncService","$rootScope"]}(),function(){function e(e,n,t,o,r,a,c,i,s,u){function l(){function t(){function e(e){$.universalHeaders=e}r.getUniversalHeaders().then(e).catch(w)}function o(){e.getSourceMaps().then(function(e){$.maps=e}).catch(w)}u.authenticate(),$.isLoading=!0,function(){function e(e){$.campaign=e.campaign,$.client=e.client}return n.getCampaign().then(e).catch(w)}().then(t).then(o).then(function(){$.isLoading=!1})}function d(){function n(e){function n(e){e.match?(!function(){$.state.showJSONRecords=!0,$.state.mapping=!1}(),t(e.header),o.convertCsvRecordsToJson($.originalRecords).then(function(e){$.records=e,console.log($.records)}).then(m)):function(){$.state.mapping=!0}()}function t(e){$.header=e.header,$.header_id=e.headerObj._id,$.originalRecords[0]=e.header}return $.originalHeader=e[0],$.originalRecords=e.slice(1,e.length-1),r.checkHeader($.originalHeader).then(n)}if($.success="",$.errorMessage="",function(){return!!$.file&&(console.log("file: ",$.file),!e.filenameExists($.campaign.Files,$.file.name))}()){$.isLoading=!0,setTimeout(function(){o.readFile($.file).then(n).then(function(){$.isLoading=!1})},400)}else $.errorMessage="This file has already been uploaded!"}function f(){function e(e){return{header:e.header.header,headerObj:e.header.headerObj,match:!0}}function n(e){console.log("headerinfo :",e),$.originalHeader=e.header,$.header_id=e.headerObj._id,$.originalRecords[0]=e.header}function t(){return o.convertCsvRecordsToJson($.originalRecords)}function a(e){$.records=e,$.isLoading=!1,$.state.mapping=!1,$.state.showJSONRecords=!0}$.isLoading=!0,function(){if(!$.selectedHeaders||!$.originalHeader)throw new Error("Header mapping not created!");$.headerMap=r.createMap($.selectedHeaders,$.originalHeader)}(),$.errorMessage="",!function(){return r.getMapLength($.headerMap)===$.originalHeader.length}()?($.errorMessage="You have a duplicate in your header mapping! Please check what you have selected.",$.isLoading=!1):r.postHeaderMap($.headerMap).then(e).then(n).then(t).then(a).then(m).catch(w)}function p(){$.completeMap=r.isMapComplete($.selectedHeaders,$.originalHeader)}function m(){function e(e){function t(t){t.Source===e.Name&&(t.Source=e.Source,t.OriginalCost=e.Source.Cost,n++)}$.records.forEach(t)}var n=0;$.maps.forEach(e),function(){n===$.records.length?($.state.readytoUpload=!0,$.state.showJSONRecords=!1,$.state.createSourceMaps=!1):($.state.createSourceMaps=!1,$.state.readytoUpload=!1,$.state.showJSONRecords=!0)}()}function h(){$.isLoading=!0,$.state.createSourceMaps=!0,$.state.showJSONRecords=!1,$.existingSources=g(),$.canMap=$.existingSources.length>0,$.isLoading=!1}function g(){function e(e){e.Source&&-1===n.indexOf(e.Source)&&(e.Source.Name||n.push(e.Source))}var n=[];return $.records.forEach(e),n}function v(){function e(e){$.existingSources=g(),$.showMap=!0,$.success=e.length+" Source maps created successfully",$.state.readytoUpload=0===$.existingSources.length,$.state.createSourceMaps=0!==$.existingSources.length}$.canMap?i.saveSourceMap({map:function(){function e(e,t){n.push({Name:$.existingSources[t],Source:e,Campaign:$.campaign})}var n=[];return $.sourceMapping.forEach(e),function(e){function n(e){function n(n){n.Source===e.Name&&(n.Source=e.Source,n.OriginalCost=e.Source.Cost)}$.records.forEach(n)}e.forEach(n)}(n),n}()}).then(e).catch(w):function(){function e(e){return e.Source=$.selectedSource,e.OriginalCost=$.selectedSource.Cost,e}$.selectedSource&&($.records=$.records.map(e),function(){$.showMap=!0,$.success="All Sources Set to: "+$.selectedSource.DisplayName,$.sourcesSet=!0,$.state.createSourceMaps=!1,$.state.readytoUpload=!0}())}()}function S(e){function n(e){$.source={},$.campaign.Sources.push(s.setTimestamp(e.source))}$.source.Campaign=$.campaign._id,e.$valid&&c.postSource($.source).then(n).catch(w),e.$setPristine()}function y(){function n(e){$.success=$.file.name+" uploaded successfully! "+e.response.count+" records uploaded with "+e.response.dupes+" duplicate records and "+e.response.dupesWithinFile+" Duplicates within the file.",$.campaign=e.campaign,$.state.readytoUpload=!1,$.state.createSourceMaps=!1,$.state.showJSONRecords=!1,$.isLoading=!1,$.sourceMapping=[],$.showMap=!1,l()}$.records&&($.isLoading=!0,e.postRecords($.records,$.file.name,$.header_id).then(n).catch(w))}function C(e){$.sortKey=e,$.sortKey===e&&($.reverse=!$.reverse)}function w(e){console.log(e)}var $=this;$.campaign={},$.client={},$.state={mapping:!1,showJSONRecords:!1,createSourceMaps:!1,readytoUpload:!1},$.isLoading=!1,$.hideMenu=!1,$.uploadFileToBrowser=d,$.selectedHeaders=[],$.checkMapIsComplete=p,$.postMap=f,$.existingSources=[],$.sourceMapping=[],$.types=["","Stand Alone","Grid","Phone Leads"],$.showMap=!1,$.showAdd=!1,$.setSources=h,$.showSource=h.showSource,$.addsource=S,$.saveSourceMap=v,$.submitRecords=y,$.nav=a,$.sort=C,l()}angular.module("upload").controller("UploadCtrl",e),e.$inject=["UploadService","SingleCampaignService","Papa","FileParser","HeaderService","Navigation","SourceService","SourceUploadService","DateFormat","authentication"]}(),function(){function e(e,n,t,o){function r(n){var t=e.defer(),o=new FileReader;return m.filename=n.name,-1!==n.name.indexOf(".xls")?o.readAsArrayBuffer(n):-1!==n.name.indexOf(".csv")&&o.readAsText(n),o.onload=function(e){a(e,t)},t.promise}function a(e,n){var t={},r=e.target.result;return-1!==m.filename.indexOf(".xls")?t=o.parse(c(r)):-1!==m.filename.indexOf(".csv")&&(t=o.parse(r)),t?n.resolve(t.data):n.reject("There was an error uploading the file")}function c(e){for(var n=new Uint8Array(e),t=[],o=0;o!==n.length;o++)t[o]=String.fromCharCode(n[o]);var r=t.join(""),a=XLSX.read(r,{type:"binary"}),c=a.Sheets[a.SheetNames[0]];return XLSX.utils.sheet_to_csv(c)}function i(n){var o=e.defer(),r=angular.copy(t);return r.Header=n,new p(r).$save(r,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function s(){var n=e.defer();return p.get(t,function(e){e.error?n.reject(e.error):n.resolve(e.data)}),n.promise}function u(n){var o=e.defer();return p.update(t,{map:n},function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function l(e,n){var t={};return e.forEach(function(e,o){t[e]=n[o]}),t}function d(e,n){if(e.length===n.length){for(var t=0;t<e.length;t++)if(void 0===e[t]||""===e[t])return!1;return!0}return!1}function f(e){var n=0;for(var t in e)console.log(t),n++;return n}var p=n("/api/:acronym/:path/headers",{acronym:"@Acronym",path:"@Path"},{update:{method:"PUT"}}),m={};return{readFile:r,checkHeader:i,getUniversalHeaders:s,postHeaderMap:u,createMap:l,isMapComplete:d,getMapLength:f}}angular.module("upload").factory("HeaderService",e),e.$inject=["$q","$resource","$routeParams","Papa"]}(),function(){function e(e,n){function t(t){function o(e){a()?c.resolve(n.parse(function(e){for(var n=new Uint8Array(e),t=[],o=0;o!==n.length;o++)t[o]=String.fromCharCode(n[o]);var r=t.join(""),a=XLSX.read(r,{type:"binary"}),c=a.Sheets[a.SheetNames[0]];return XLSX.utils.sheet_to_csv(c)}(e)).data):r()&&c.resolve(n.parse(e).data),c.reject("Something f**ked up man...")}function r(){return-1!==t.name.indexOf(".csv")}function a(){return-1!==t.name.indexOf(".xls")}var c=e.defer(),i=new FileReader;if(r()||a())return a()&&i.readAsArrayBuffer(t),r()&&i.readAsText(t),i.onload=function(e){o(e.target.result)},c.promise}function o(t){function o(e){return!(void 0===e.MobilePhone&&void 0===e.HomePhone)}var r=e.defer(),a=n.parse(n.unparse(t),{header:!0}).data;return r.resolve(a.filter(o)),r.promise}return{readFile:t,convertCsvRecordsToJson:o}}angular.module("upload").factory("FileParser",e),e.$inject=["$q","Papa"]}(),function(){function e(e,n,t){function o(e){var o=n.defer();return new r(e).$save(t,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}var r=e("/api/:acronym/:path/source-map");return{saveSourceMap:o}}angular.module("upload").factory("SourceUploadService",e),e.$inject=["$resource","$q","$routeParams"]}(),function(){function e(e,n,t,o){function r(n,o,r){var a=e.defer();return new i({records:n,filename:o,header:r}).$save(t,function(e){e.error?a.reject(e.error):a.resolve(e.data)}),a.promise}function a(){var o=e.defer();return n("/api/:acronym/:path/source-map").get(t,function(e){e.error?o.reject(e.error):o.resolve(e.data)}),o.promise}function c(e,n){function t(e){function t(e){return e.replace(".xlsx","").replace(".xls","").replace(".csv","")}console.log("file: ",e),console.log("current: ",n),t(e.Name)===t(n)&&(o=!0)}var o=!1;return e?(e.forEach(t),o):o}var i=n("/api/:acronym/:path/records",{acronym:"@Acronym",path:"@Path"},{update:{method:"PUT"}});return{postRecords:r,filenameExists:c,getSourceMaps:a}}angular.module("upload").factory("UploadService",e),e.$inject=["$q","$resource","$routeParams","Papa"]}();